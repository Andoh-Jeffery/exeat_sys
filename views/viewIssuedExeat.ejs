<!DOCTYPE html>
<html lang="en">
<%- include('../partials/head.ejs') -%>

  <body class="">
    <%- include('../partials/nav.ejs',{auth:auth,data:data}) -%> <%- include('../partials/header.ejs') -%>
        <section class="pcoded-main-container">
          <div class="pcoded-content">
            <div class="page-header">
              <div class="page-block">
                <div class="row align-items-center">
                  <!-- <div class="col-md-12">
                <div class="page-header-title">
                  <h5 class="m-b-10">Advanced DataTable</h5>
                </div>
                <ul class="breadcrumb">
                  <li class="breadcrumb-item">
                    <a href="index.html"><i class="feather icon-home"></i></a>
                  </li>
                  <li class="breadcrumb-item"><a href="#!">Data Table</a></li>
                  <li class="breadcrumb-item">
                    <a href="#!">Advanced Initialization</a>
                  </li>
                </ul>
              </div> -->
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-12">
                <div class="card">
                  <div class="card-header">
                    <h5>List of Exeat Issued</h5>
                  </div>
                  <div class="card-body">
                    <div class="table-responsive dt-responsive">
                      <table id="dom-jqry" class="table table-striped table-bordered nowrap">
                        <%if(auth==='00'){%>

                          <thead>
                            <tr>
                              <th>Student Name</th>
                              <th>Reason</th>
                              <th>Date Of Issue</th>
                              <th>Date Of Return</th>
                              <th>Parent Telephone</th>
                              <th>Status</th>
                            </tr>
                          </thead>
                          <%}else if(auth==='0' ){%>

                            <thead>
                              <tr>
                                <th>Student Name</th>
                                <th>Reason</th>
                                <th>Date Of Issue</th>
                                <th>Date Of Return</th>
                                <th>Parent Telephone</th>
                                <th>Status</th>
                                <th>Returned</th>
                              </tr>
                            </thead>
                            <%}else{%>
                              <thead>
                                <tr>
                                  <th>Student Name</th>
                                  <th>Reason</th>
                                  <th>Date Of Issue</th>
                                  <th>Date Of Return</th>
                                  <th>Parent Telephone</th>
                                  <th>Status</th>
                                  <th>Returned</th>
                                </tr>
                              </thead>
                              <%}%>
                                <tbody>
                                  <%issuedExeat.forEach(exeat=>{%>
                                    <%if (auth==='00' ){%>
                                      <tr>
                                        <td>
                                          <%=exeat.data().studentName%>
                                        </td>
                                        <td>
                                          <%=exeat.data().reason%>
                                        </td>
                                        <td>
                                          <%=moment(exeat.data().dateOfIssue).format('LL')%>
                                        </td>
                                        <td>
                                          <%=moment(exeat.data().dateOfReturn).format('LL')%>
                                        </td>
                                        <td>
                                          <%=exeat.data().parentTelephone%>
                                        </td>
                                        <%if(date> exeat.data().dateOfReturn){%>
                                          <td class="badge badge-danger"> overstayed</td>
                                          <%}else{%>
                                            <td class="badge badge-info">not returned</td>

                                            <%}%>
                                      </tr>
                                      <%}else if(auth==='0' ){%>
                                        <tr>

                                          <td>
                                            <%=exeat.data().studentName%>
                                          </td>
                                          <td>
                                            <%=exeat.data().reason%>
                                          </td>
                                          <td>
                                            <%=moment(exeat.data().dateOfIssue).format('LL')%>
                                          </td>
                                          <td>
                                            <%=moment(exeat.data().dateOfReturn).format('LL')%>
                                          </td>
                                          <td>
                                            <%=exeat.data().parentTelephone%>
                                          </td>
                                          <%if(date> exeat.data().dateOfReturn){%>
                                            <!-- <script>
                                              const status = document.getElementById('status')
                                              status.style.display = 'block'
                                            </script> -->
                                            <td class="badge badge-danger"> overstayed</td>
                                            <%}else{%>
                                              <td class="badge badge-info">not returned</td>

                                              <%}%>
                                                <td style="margin-left:10px;">
                                                  <a data-id="<%=exeat.id%>" class="check_btn"><i
                                                      class="feather fa-lg icon-check p-15"
                                                      style="color: green;cursor: pointer;"> </i></a>
                                                </td>
                                        </tr>
                                        <%}else{%>
                                          <tr>
                                            <td>
                                              <%=exeat.data().studentName%>
                                            </td>
                                            <td>
                                              <%=exeat.data().reason%>
                                            </td>
                                            <td>
                                              <%=moment(exeat.data().dateOfIssue).format('LL')%>
                                            </td>
                                            <td>
                                              <%=moment(exeat.data().dateOfReturn).format('LL')%>
                                            </td>
                                            <td>
                                              <%=exeat.data().parentTelephone%>

                                            </td>
                                            <%if(date> exeat.data().dateOfReturn){%>
                                              <!-- <script>
                                                const status = document.getElementById('status')
                                                status.style.display = 'block'
                                              </script> -->
                                              <td class="badge badge-danger"> overstayed </td>
                                              <%}else{%>
                                                <td class="badge badge-info">not returned</td>
                                                <%}%>
                                                  <td>
                                                    <a data-id="<%=exeat.id%>" class="check_btn"
                                                      style="cursor: pointer;"><i class="feather fa-lg icon-check p-15"
                                                        style="color: green;cursor: pointer;"></i></a>
                                                  </td>
                                          </tr>
                                          <%}%>
                                            <%})%>
                                </tbody>
                                <!-- <tfoot>
                      <tr>
                        <th>Student Name</th>
                        <th>Reason</th>
                        <th>Date Of Issue</th>
                        <th>Date Of Return</th>
                        <th>Parent Telephone</th>
                        <th>Returned</th>
                      </tr>
                    </tfoot> -->
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!--[if lt IE 11]>
      <div class="ie-warning">
        <h1>Warning!!</h1>
        <p>
          You are using an outdated version of Internet Explorer, please upgrade
          <br />to any of the following web browsers to access this website.
        </p>
        <div class="iew-container">
          <ul class="iew-download">
            <li>
              <a href="http://www.google.com/chrome/">
                <img src="assets/images/browser/chrome.png" alt="Chrome" />
                <div>Chrome</div>
              </a>
            </li>
            <li>
              <a href="https://www.mozilla.org/en-US/firefox/new/">
                <img src="assets/images/browser/firefox.png" alt="Firefox" />
                <div>Firefox</div>
              </a>
            </li>
            <li>
              <a href="http://www.opera.com">
                <img src="assets/images/browser/opera.png" alt="Opera" />
                <div>Opera</div>
              </a>
            </li>
            <li>
              <a href="https://www.apple.com/safari/">
                <img src="assets/images/browser/safari.png" alt="Safari" />
                <div>Safari</div>
              </a>
            </li>
            <li>
              <a
                href="http://windows.microsoft.com/en-us/internet-explorer/download-ie"
              >
                <img src="assets/images/browser/ie.png" alt="" />
                <div>IE (11 & above)</div>
              </a>
            </li>
          </ul>
        </div>
        <p>Sorry for the inconvenience!</p>
      </div>
    <![endif]-->
        <%- include('../partials/scripts.ejs') -%>
          <script>
            const Toast = Swal.mixin({
              toast: true,
              position: 'top-end',
              showConfirmButton: false,
              timer: 1500,
              didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer)
                toast.addEventListener('mouseleave', Swal.resumeTimer)
              }
            })
            document.addEventListener("DOMContentLoaded", () => {
              let check_btn = document.querySelectorAll('.check_btn');
              for (let i = 0; i < check_btn.length; i++) {
                const element = check_btn[i];
                element.addEventListener('click', (e) => {
                  e.preventDefault()
                  console.log('/student/issued/' + element.dataset.id)
                  fetch('/student/issued/' + element.dataset.id, {
                    method: "put",
                  }).then((response) => response.json())
                    .then((updateResponse) => {
                      console.log('updated');
                      Toast.fire({
                        icon: 'success',
                        iconColor: '#6ade66',
                        title: 'Student returned'
                      })
                      location.reload();
                    }).catch(error => {
                      Toast.fire({
                        icon: 'Error',
                        iconColor: '#ff0000',
                        title: 'Error returning student'
                      })
                      console.log(error);
                    })
                })

              }
            });
          </script>
  </body>


</html>