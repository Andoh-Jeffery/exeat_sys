<!DOCTYPE html>
<html lang="en">
  <%-include('../partials/head.ejs')-%>
  <body class="">
    <%-include('../partials/nav.ejs',{auth:auth,data:data})-%> <%-include('../partials/header.ejs')-%>
    <section class="pcoded-main-container">
      <div class="pcoded-content">
        <div class="page-header">
          <div class="page-block">
            <div class="row align-items-center">
              <!-- <div class="col-md-12">
                <div class="page-header-title">
                  <h5 class="m-b-10">Advanced DataTable</h5>
                </div>
                <ul class="breadcrumb">
                  <li class="breadcrumb-item">
                    <a href="index.html"><i class="feather icon-home"></i></a>
                  </li>
                  <li class="breadcrumb-item"><a href="#!">Data Table</a></li>
                  <li class="breadcrumb-item">
                    <a href="#!">Advanced Initialization</a>
                  </li>
                </ul>
              </div> -->
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12">
            <div class="card">
              <div class="card-header">
                <h5>List of Exeat Issued</h5>
              </div>
              <div class="card-body">
                <div class="table-responsive dt-responsive">
                  <table
                    id="dom-jqry"
                    class="table table-striped table-bordered nowrap"
                  >
                    <thead>
                      <tr>
                        <th>Student Name</th>
                        <th>Reason</th>
                        <th>Date Of Issue</th>
                        <th>Date Of Return</th>
                        <th>Parent Telephone</th>
                        <th>Returned</th>
                      </tr>
                    </thead>
                    <tbody>
                      <%issuedExeat.forEach(exeat=>{%>
                        
                        <tr>
                          <td><%=exeat.data().studentName%></td>
                          <td><%=exeat.data().reason%></td>
                          <td><%=moment(exeat.data().dateOfIssue).format('LL')%></td>
                          <td><%=moment(exeat.data().dateOfIssue).format('LL')%></td>
                          <td><%=exeat.data().parentTelephone%></td>
                          <td>
                            <a data-id="<%=exeat.id%>" class="check_btn"><i class="feather fa-lg icon-check p-15" style="color: green;cursor: pointer;"></i></a>
                          </td>
                        </tr>
                      <%})%>
                    </tbody>
                    <tfoot>
                      <tr>
                        <th>Student Name</th>
                        <th>Reason</th>
                        <th>Date Of Issue</th>
                        <th>Date Of Return</th>
                        <th>Parent Telephone</th>
                        <th>Returned</th>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!--[if lt IE 11]>
      <div class="ie-warning">
        <h1>Warning!!</h1>
        <p>
          You are using an outdated version of Internet Explorer, please upgrade
          <br />to any of the following web browsers to access this website.
        </p>
        <div class="iew-container">
          <ul class="iew-download">
            <li>
              <a href="http://www.google.com/chrome/">
                <img src="assets/images/browser/chrome.png" alt="Chrome" />
                <div>Chrome</div>
              </a>
            </li>
            <li>
              <a href="https://www.mozilla.org/en-US/firefox/new/">
                <img src="assets/images/browser/firefox.png" alt="Firefox" />
                <div>Firefox</div>
              </a>
            </li>
            <li>
              <a href="http://www.opera.com">
                <img src="assets/images/browser/opera.png" alt="Opera" />
                <div>Opera</div>
              </a>
            </li>
            <li>
              <a href="https://www.apple.com/safari/">
                <img src="assets/images/browser/safari.png" alt="Safari" />
                <div>Safari</div>
              </a>
            </li>
            <li>
              <a
                href="http://windows.microsoft.com/en-us/internet-explorer/download-ie"
              >
                <img src="assets/images/browser/ie.png" alt="" />
                <div>IE (11 & above)</div>
              </a>
            </li>
          </ul>
        </div>
        <p>Sorry for the inconvenience!</p>
      </div>
    <![endif]-->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
                            let check_btn = document.querySelectorAll('.check_btn');
                            for (let i = 0; i < check_btn.length; i++) {
                                const element = check_btn[i];
                                element.addEventListener('click', (e) => {
                                    e.preventDefault()
                                    console.log('/student/issued/'+ element.dataset.id)
                                    fetch('/student/issued/'+ element.dataset.id,{
                                        method:"put",
                                    }).then((response)=>response.json())
                                    .then((updateResponse)=>{
                                        console.log('updated');
                                        document.location.reload();
                                }).catch(error=>{
                                    console.log(error);
                                })
                                })

                            }
      });
    </script>
  </body>
  <%-include('../partials/scripts.ejs')-%>
</html>
